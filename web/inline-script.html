<h1>Inline script</h1>

<p>An inline script can be bound to the parent html element.</p>

<div>
  <output></output>
  <script data-cfg='{"foo": "bar"}'>
    // Scoping is necessary, other way it would pollute the global scope
    (() => {
      let $parent = document.currentScript.parentElement;
      let $output = $parent.querySelector("output");

      const cfg = JSON.parse(document.currentScript.dataset.cfg);
      $output.textContent = `The script is called with the config: ${JSON.stringify(cfg)}`;

      // === Listening to global events with resubscription on the script reload
      const abortKey = Symbol.for("my_project:my_script:abort"); // An unique per-script key
      window[abortKey]?.abort();
      window[abortKey] = new AbortController();

      document.addEventListener(
        "click",
        (evt) => console.log("Document click:", evt),
        { signal: window[abortKey].signal },
      );

      // The same abort key could be used for multiple events
      document.addEventListener(
        "keydown",
        (evt) => console.log("Document keydown:", evt),
        { signal: window[abortKey].signal },
      );
    })();
  </script>
</div>
